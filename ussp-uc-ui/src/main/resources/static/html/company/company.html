
  <div class="layui-fluid" lay-filter="position_auth">
  	<div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
	  <ul class="layui-tab-title">
		<li class="layui-this">公司信息</li>
	    <li>公司账户</li>
	  </ul>
  
  
	  <div class="layui-tab-content">
	 	<!-- 公司信息  -->
	    <div class="layui-tab-item layui-show">
	    
			<table class="layui-hide" id="boaInCompany"></table>
			
		</div>
	    
	    <!-- 公司账户  -->
	    <div class="layui-tab-item">
					<table id="boaInCompanyAccount" class="layui-hide" lay-filter="filter_boaInCompanyAccount">
					</table>
					<script type="text/html" id="user_busi_datatable_bar">
                <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail" ht-auth="detail">查看</a>
                <a class="layui-btn layui-btn-xs" lay-event="edit" ht-auth="edit">编辑</a>
                <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del" ht-auth="del">删除</a>
            </script>
		</div>
	
	  </div>
	</div> 
	
	 <!--新增表单-->
    <div id="position_add_data_div" class="hide">
        <form method="post" class="layui-form" lay-filter="filter_add_position_form">
            <div class="layui-form-item">
                <label class="layui-form-label">岗位编号<b>*</b></label>
                <div class="layui-input-block">
                    <input type="text" name="positionCode" id="positionCode" lay-verify="required|checkExistPosCode" maxlength="20" autocomplete="off" lay-verType="tips" class="layui-input layui-input-sm">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">岗位名称<b>*</b></label>
                <div class="layui-input-block">
                    <input type="text" name="positionName" lay-verify="required" maxlength="40" autocomplete="off" lay-verType="tips" class="layui-input layui-input-sm">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">所属机构<b>*</b></label>
                <div class="layui-input-block">
                    <input type="text" id="position_org_tree_select" name="orgName" autocomplete="off"  lay-verType="tips" class="layui-input layui-input-sm">
                    <input type="hidden" name="orgCode" autocomplete="off" readonly lay-verType="tips" class="layui-input layui-input-sm">
                    <input type="hidden" name="orgPath" autocomplete="off" readonly lay-verType="tips" class="layui-input layui-input-sm">
                    <input type="hidden" name="rootOrgCode" autocomplete="off" readonly lay-verType="tips" class="layui-input layui-input-sm">
                    <input type="hidden" name="pOrgCode" autocomplete="off" readonly lay-verType="tips" class="layui-input layui-input-sm">
                    <input type="hidden" name="rOrgCode" autocomplete="off" readonly lay-verType="tips" class="layui-input layui-input-sm">
                </div>
            </div>
            <button class="layui-btn hide" lay-submit="" lay-filter="filter_add_position_form"></button>
        </form>
    </div>
	
	
</div> 






<script>
layui.use('table', function(){
  var table = layui.table;
 // 公司信息
  table.render({
      id: 'boaInCompany'
      , elem: '#boaInCompany'
      , url: layui.ht_config.basePath + 'company'
      // , where: {
      //     query: {
      //         businessOrgCode: "DEV1"
      //     }
      // }5
      , limit : 15
      , limits :[5, 10,15, 20, 30, 40, 50]
      , page: true
      , height: 'full-200'
      , cols: [[
          {type: 'numbers',event: 'rowClick'}
          , {field: 'companyName', width: 110, title: '公司名称',event: 'rowClick'}
          , {field: 'companyAddress',   title: '公司地址',event: 'rowClick'}
          , {field: 'companyAddressContract',   title: '分公司地址(合同)',event: 'rowClick'}
          , {field: 'companyNameContract',   title: '分公司名称(合同)',event: 'rowClick'}
          , {field: 'companyPhone',   title: '电话',event: 'rowClick'}
          , {field: 'companyPhoneContract',   title: '电话(合同)',event: 'rowClick'}
          , {field: 'companyPledgeEmailContract',   title: '抵押权人电子邮件',event: 'rowClick'}
          , {field: 'businessPhone', width: 100, title: '客服电话',event: 'rowClick'}
          , {field: 'companyPledgeEmailContract',   title: '登录ID',event: 'rowClick'}
         // , {field: 'updateOperator', width: 100, title: '更新人'}
         // , {field: 'lastModifiedDatetime', width: 150, title: '更新时间',event: 'rowClick'}
         //  , {fixed: 'right', width: 230, title: '操作', align: 'center', toolbar: '#user_busi_datatable_bar'}
      ]]
  });
 //事件监听
  table.on('renderComplete(user_busi_datatable_bar)', function (obj) {
	var data = obj.data;
	if (obj.event === 'del') {
        layer.confirm('是否确认删除岗位？', function (index) {
        	 $.post(delPositionUrl+"?id=" + data.id, null, function (result) {
                 if (result["returnCode"] == "0000") {
                	 obj.del();
                     layer.close(index);
                     layer.msg("删除岗位成功");
                 } else {
                     layer.msg(result.codeDesc);
                 }
                 refreshTable();
             });
        });
    } else if (obj.event === 'edit') {
        editDialog = layer.open({
        	 type: 1,
             area: ['400px', '400px'],
             maxmin: true,
             shadeClose: true,
             title: "修改岗位",
             content: $("#position_modify_data_div").html(),
             btn: ['保存', '取消'],
             yes: function (index, layero) {
                 var $submitBtn = $("button[lay-filter=filter_modify_position_form]", layero);
                 if ($submitBtn) {
                     $submitBtn.click();
                 } else {
                     throw new Error("没有找到submit按钮。");
                 }
             },
             btn2: function () {
                 layer.closeAll('tips');
             },
            success: function (layero) {
            	//加载表单数据
                $.each(data, function (name, value) {
                    var $input = $("input[name=" + name + "]", layero);
                    if ($input && $input.length == 1) {
                        $input.val(value);
                    }
                });
                
                form.render(null, "filter_modify_position_form");
                form.on('submit(filter_modify_position_form)', function (data) {
                    $.ajax({
                        type: "POST",
                        url: addPositionUrl,
                        data: JSON.stringify(data.field),
                        contentType: "application/json; charset=utf-8",
                        success: function (result2) {
                            layer.close(editDialog);
                            if (result2["returnCode"] == '0000') {
                            	layer.msg("岗位修改成功");
                                refreshTable();
                            }
                        },
                        error: function (message) {
                            layer.msg("岗位修改发生异常，请联系管理员。");
                            layer.close(index);
                            console.error(message);
                        }
                    });
                    return false;
                });
            }
        });
        
    }
	
  });
 
});

//公司账户
layui.use('table', function(){
	var $ = layui.jquery, layer = layui.layer; //独立版的layer无需执行这一句
	  var table = layui.table;
	   table.render({
	        id: 'boaInCompanyAccount'
	        , elem: '#boaInCompanyAccount'
	        , url: layui.ht_config.basePath + 'company/getCompanyList'
	        // , where: {
	        //     query: {
	        //         businessOrgCode: "DEV1"
	        //     }
	        // }5
	        , limit : 15
	        , limits :[5, 10,15, 20, 30, 40, 50]
	        , page: true
	        , height: 'full-200'
	        , cols: [[
	            {type: 'numbers',event: 'rowClick'}
	            , {field: 'companyName', width: 110, title: '公司名称',event: 'rowClick'}
	            , {field: 'companyAddress',   title: '公司地址',event: 'rowClick'}
	            , {field: 'companyAddressContract',   title: '分公司地址(合同)',event: 'rowClick'}
	            , {field: 'companyNameContract',   title: '分公司名称(合同)',event: 'rowClick'}
	            , {field: 'companyPhone',   title: '电话',event: 'rowClick'}
	            , {field: 'companyPhoneContract',   title: '电话(合同)',event: 'rowClick'}
	            , {field: 'companyPledgeEmailContract',   title: '抵押权人电子邮件',event: 'rowClick'}
	            , {field: 'businessPhone', width: 100, title: '客服电话',event: 'rowClick'}
	            , {field: 'companyPledgeEmailContract',   title: '登录ID',event: 'rowClick'}
	           // , {field: 'updateOperator', width: 100, title: '更新人'}
	           // , {field: 'lastModifiedDatetime', width: 150, title: '更新时间',event: 'rowClick'}
 	            , {fixed: 'right', width: 230, title: '操作', align: 'center', toolbar: '#user_busi_datatable_bar'}
	        ]]
	    });
	  
	   //事件监听
	   table.on('renderComplete(user_busi_datatable_bar)', function (obj) {
		   if (obj.event === 'edit') {
			   addDialog;
			   
		   }
	   });
	   var addDialog = layer.open({
           type: 1,
           area: ['400px', '400px'],
           maxmin: true,
           shadeClose: true,
           title: "新增岗位",
           content: $("#position_add_data_div").html(),
           btn: ['保存', '取消'],
           yes: function (index, layero) {
               var $submitBtn = $("button[lay-filter=filter_add_position_form]", layero);
               if ($submitBtn) {
                   $submitBtn.click();
               } else {
                   throw new Error("没有找到submit按钮。");
               }
           },
           btn2: function () {
               layer.closeAll('tips');
           },
           success: function (layero, index) {
               //填充选中的组织机构
               $("input[name=orgName]", layero).val(nodes[0]["orgNameCn"]);
               $("input[name=orgCode]", layero).val(nodes[0]["orgCode"]);
               $("input[name=orgPath]", layero).val(nodes[0]["orgPath"]);
               $("input[name=rOrgCode]", layero).val(nodes[0]["rootOrgCode"]);
               $("input[name=pOrgCode]", layero).val(nodes[0]["orgCode"]);
               form.render(null, "filter_add_position_form");
               form.on('submit(filter_add_position_form)', function (data) {
                   $.ajax({
                       type: "POST",
                       url: addPositionUrl,
                       data: JSON.stringify(data.field),
                       contentType: "application/json; charset=utf-8",
                       success: function (message) {
                           layer.close(addDialog);
                           if (message.returnCode == '0000') {
                           	 layer.msg("岗位新增成功");
                              /* table.reload('position_datatable', {
                                   page: {
                                       curr: 1 //重新从第 1 页开始
                                   }
                                   , where: {
                                       query: {
                                           orgCode: nodes[0]["orgCode"]
                                       }
                                   }
                               });*/
                           	 refreshTable();
                           }
                       },
                       error: function (message) {
                           layer.msg("岗位新增发生异常，请联系管理员。");
                           console.error(message);
                       }
                   });
                   return false;
               });
           }
       });
	   
	   
	   
	});
</script>

